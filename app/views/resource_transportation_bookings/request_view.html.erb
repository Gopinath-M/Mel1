<script>
  $("#driver_change_button").live("click",function(){
    $("#normal").hide();
    $("#changed_driver").hide();
    $('#alternate').show();    
  });

  $("#driver_name").live("change",function(){
    if ($("#driver_name").val() != 'SELECT A VEHICLE')
    {
      $('#alternate').hide();      
      $('#changed_driver').text($("#driver_name").val()).css("font-weight", "bold");
      $('#changed_driver').append('<input type="button" id="driver_change_button" name="Change" value="Change" />');
      $("#changed_driver").show();
      $("#alternate_driver").val($("#driver_name").val());
    }
  });

  $().ready(function() {
    $('#alternate').hide();
    $('#changed_driver').hide();
  });
</script>

<%= form_tag :controller=>"resource_transportation_bookings",:action=>"change_resource_status" do %>
  <div class="clearfix">&nbsp;</div>
  <div class="CenterNav">
    <h2 class="b-head">Resource Transport Approval</h2>
    <%= hidden_field_tag :id,(@resource_transportation_booking.id)  %>
    <div class="form-sec">
      <div class="form-sec-row form-sec-row1">
        <td><table width="500" border="0" cellspacing="0" cellpadding="0" align="center">
            <tr>
              <td style=" font-family:Arial, Helvetica, sans-serif; font-size:12px; color:#333; border-bottom:1px solid #CCC;border-top:1px solid #CCC; padding:10px 0;">
                <table width="750" border="2" cellspacing="3" cellpadding="3" align="center"><br/>
                  <tr>
                    <td><font color="#369"><b><u>User Details:-</u></b></font></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><b>Agency Name</b></td>
                    <td>&nbsp;<b><%= @requester.departments[0].agency.name.upcase if !@requester.is_super_admin? %></b></td>
                  </tr>
                  <tr>
                    <td><b>Department Name</b></td>
                    <td>&nbsp;<b><%= @requester.departments[0].name if !@requester.is_super_admin? %></b></td>
                  </tr>
                  <tr>
                    <td><b>First Name</b></td>
                    <td>&nbsp;<b><%= @requester.first_name.upcase %></b></td>
                  </tr>
                  <tr>
                    <td><b>Last Name</b></td>
                    <td>&nbsp;<b><%= @requester.last_name.upcase %></b></td>
                  </tr>
                  <tr>
                    <td><b>IC Number</b></td>
                    <td>&nbsp;<b><%= @requester.ic_number %></b></td>
                  </tr>
                  <tr>
                    <td><b>Email</b></td>
                    <td>&nbsp;<b><%= @requester.email %></b></td>
                  </tr>

                  <tr>
                    <td><font color="#369"><b><u>Transport Details:-</u></b></font></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><b>Date of Application</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.created_at.strftime("%dth %B %Y %l:%M:%S %p")%></b></td>
                  </tr>
                  <tr>
                    <td><b>Purpose</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.purpose%></b></td>
                  </tr>
                  <tr>
                    <td><b>Pick up place</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.pick_up_place%></b></td>
                  </tr>
                  <tr>
                    <td><b>Destination Location</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.location%></b></td>
                  </tr>
                  <tr>
                    <td><b>Destination State</b></td>
                    <td>&nbsp;<b><%=  State.find(@resource_transportation_booking.state).name %></b></td>
                  </tr>
                  <tr>
                    <td><b>Booking Date</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.requested_from_date.strftime("%dth %B %Y")%></b></td>
                  </tr>
                  <tr>
                    <td><b>Return Date</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.requested_to_date.strftime("%dth %B %Y")%></b></td>
                  </tr>
                  <tr>
                    <td><b>Number of Passengers</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.number_of_passengers%></b></td>
                  </tr>
                  <tr>
                    <td><b>Attachment</b></td>
                    <td>&nbsp;<b><%= image_tag @resource_transportation_booking.attachment_url(:profile) if @resource_transportation_booking.attachment?  %></b></td>
                  </tr>
                  <tr>
                    <td><b>Remarks</b></td>
                    <td>&nbsp;<b><%=  @resource_transportation_booking.remarks %></b></td>
                  </tr>

                  <tr>
                    <td><font color="#369"><b><u>Vehicle Details:-</u></b></font></td>
                    <td></td>
                  </tr>
                  <% if current_user.is_super_admin? %>
                    <tr>
                      <td><label class="text"> <%= label :location,raw("Status"), :class=>"text"%></label></td>
                      <td>
                        <%= select_tag :approve_status,"<option>New</option><option>Approved</option><option>Declined</option>".html_safe %>
                      </td>
                    </tr>
                  <%else%>

                    <tr>
                      <td><label class="text"> <%= label :status,raw("Status"), :class=>"text"%></label></td>
                      <td>&nbsp;<b><%= @resource_transportation_booking.status %></b></td>
                    </tr>

                    <% if @resource_transportation_booking.status == "Approved" %>
                      <%= hidden_field_tag :approve_status,"Processed"  %>
                    <%elsif @resource_transportation_booking.status == "Processed" %>
                      <%= hidden_field_tag :approve_status,"Returned"  %>
                    <%end%>

                    <% if @resource_transportation_booking.resource_returned_from_user? %>
                      <tr>
                        <td><label class="text"> <%= label :location,raw("Resource Returned From User"), :class=>"text"%></label></td>
                        <td>&nbsp;<b><%= 'Yes' %></b>
                        </td>
                      </tr>
                    <%end%>

                  <%end%>
                  <tr>
                    <td><b>Vehicle Type</b></td>
                    <td>&nbsp;<b><%=@resource_transportation_booking.sub_category.name %></b></td>
                  </tr>

                  <% if !@resource_transportation_booking.agency_store_id.blank? %>
                    <% if @resource_transportation_booking.status != "Processed" %>
                      <tr>
                        <td><b>Vehicle Model</b></td>
                        <% vehicle = Resource.find(@resource_transportation_booking.agency_store.resource_id) %>
                        <td>&nbsp;<b><%= vehicle.vehicle_model+' : '+vehicle.resource_no %></b></td>
                      </tr>

                      <tr>
                        <td><b>Driver</b></td>
                        <td>&nbsp;
                          <div id="normal" >
                            <% driver = Driver.find(@resource_transportation_booking.agency_store.driver_id) %>
                            <b><%= driver.name %></b>
                            <input type="button" id="driver_change_button" name="Change" value="Change" />
                          </div>

                          <div id="alternate">
                            <%= select("driver","name", options_from_collection_for_select(Driver.find(:all,:conditions=>["already_assigned = false"]),'name',"name"),{:prompt=>"SELECT A DRIVER"})%>
                          </div>

                          <div id="changed_driver">
                          </div>

                          <%= hidden_field_tag "alternate_driver"  %>
                        </td>
                      </tr>
                    <%else%>
                      <% vehicle = Resource.find(@resource_transportation_booking.agency_store.resource_id) %>

                      <tr>
                        <td><b>Vehicle</b></td>
                        <td>&nbsp;<b><%= vehicle.vehicle_model+' : '+vehicle.resource_no %></b></td>
                      </tr>

                      <% driver = Driver.find(@resource_transportation_booking.agency_store.driver_id) %>
                      <tr>
                        <td><b>Driver Name</b></td>
                        <td>&nbsp;<b><%= driver.name %></b></td>
                      </tr>
                      <tr>
                        <td><b>Driver Phone</b></td>
                        <td>&nbsp;<b><%= driver.telephone_number %></b></td>
                      </tr>

                    <%end%>
                  <%else%>
                    <tr>
                      <td><b>Vehicle</b></td>
                      <% a = AgencyStore.find(:all,:conditions=>["sub_category_id = ? and resource_type = ? and booked = ?",@resource_transportation_booking.sub_category_id,'transport',false]).collect(&:resource_id).join(',') %>
                      <td>
                        <%= select("vehicle","id", options_from_collection_for_select(Resource.find(:all,:conditions=>["id in (#{a})"]),'id',"resource_no"),{:prompt=>"SELECT A VEHICLE"})%>
                      </td>
                      </div>
                    </tr>
                  <%end%>
                  <tr>
                    <td>
                    </td>
                    <td>
                      <div id="driver_details">
                      </div>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <div class="form-sec-row">
          <label class="text">&nbsp;</label>
          <span class="in-box">
            <% if @resource_transportation_booking.status == "New" %>
              <%= submit_tag "Submit", :class=>"btn2",:onclick=>'return validate_request_approval_form();' %>
            <% elsif @resource_transportation_booking.status == "Approved" %>
              <%= submit_tag "Process Request", :class=>"btn2",:onclick=>'return validate_request_approval_form();' %>
            <% elsif @resource_transportation_booking.status == "Processed" %>
              <%= submit_tag "Return Request", :class=>"btn2",:onclick=>'return validate_request_approval_form();' %>
            <%end%>
          </span>
        </div>
      </div>
    </div>
  </div>

<%end%>

