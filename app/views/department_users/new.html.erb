
<div class="clearfix"></div>
<div class="CenterNav">
  <div class="form-sec">
    <h2 class="b-head">Create  User</h2>
    <%= form_for(@user, :as => :user,  :url => department_users_path, :html => { :method => :post, :multipart => true }) do |f| %>
      <%=f.error_messages%>
      <div class="clearfix">&nbsp;</div>
      <div class="form-sec-row">
        <%= f.label :first_name,raw("First Name"), :class=>"text"%>
        <span class="in-box">
          <%= f.text_field :first_name, :size => 30%>
        </span>
      </div>
      <div class="form-sec-row">
        <%= f.label :last_name,raw("Last Name"), :class=>"text"%>
        <span class="in-box">
          <%= f.text_field :last_name, :size => 30%>
        </span>
      </div>
      <div class="form-sec-row">
        <label class="text">Email <span style=color:red>*</span></label>
        <span class="in-box">
          <%= f.text_field :email, :size => 30%>
        </span>
      </div>
      <div class="form-sec-row">
       <label class="text">IC Number<span style=color:red>*</span></label>
          <input class="icnumber" type="text"  maxlength="6" size="6" name="num1">&nbsp;-
           <input class="icnumber1" type="text"  maxlength="2" size="2" name="num2">&nbsp;-
           <input class="icnumber2" type="text"  maxlength="4" size="4" name="num3">
      </div>

      <div class="form-sec-row">
        <%= f.label :avatar,raw("Avatar"), :class=>"text"%>
        <span class="in-box">
          <%= f.file_field :avatar%>
          <%= f.hidden_field :avatar_cache %>
        </span>
      </div>
      <div class="form-sec-row">
        <%= f.label :username,raw("Display Name"), :class=>"text"%>
        <span class="in-box">
          <%= f.text_field :username, :size => 30%>
          <i>(This name will be used through out the site)</i>
        </span>
      </div>
      <div class="form-sec-row">
        <%= f.label :city,raw("City"), :class=>"text"%>
        <span class="in-box">
          <%= f.text_field :city, :size => 30%>
        </span>
      </div>
      <div class="form-sec-row">
        <label class="text">State<span style=color:red>*</span></label>
        <span class="in-box">
          <%= f.select(:state, State.all.collect {|p| [p.name.upcase, p.id]} ,:prompt => "SELECT A STATE")%>
        </span>
      </div>
      <div class="form-sec-row">
        <%= f.label :zipcode,raw("Zipcode"), :class=>"text"%>
        <span class="in-box">
          <%= f.text_field :zipcode, :size => 30%>
        </span>
      </div>
      <%if current_user.is_super_admin? %>
      <div class="form-sec-row">
        <%= label_tag :role_id, raw("Role"), :class=>"text" %>
        <span class="in-box">
          <%if @admin%>
        <%= select("role", "id", Role.where("name != 'Super Admin' && name != 'Department User'").collect {|role| [role.name, role.id]},:prompt=>"SELECT A ROLE") %>
          <%else%>
          <%= select("role", "id", Role.where("name != 'Super Admin' && name != 'Department Admin'").collect {|role| [role.name, role.id]},:prompt=>"SELECT A ROLE") %>
          <%end%>
        </span>
      </div>
      <div class="form-sec-row">
        <%= label_tag "users_agency", raw("Agency"), :class=>"text" %>
        <span class="in-box">
          <%= select("users","agency",  Agency.active.collect {|agency| [agency.name, agency.id]},:prompt=>"SELECT AN AGENCY") %>
        </span>
      </div>
      <div class="form-sec-row">
        <%= label_tag "users_department", raw("Department"), :class=>"text"%>
        <span class="in-box">          
          <%= select("users","department",Department.active.where("agency_id =?", params[:agency]).collect {|p| [ p.name, p.id ] },:prompt => "SELECT A DEPARTMENT") %>
        </span>
      </div>
      <div class="form-sec-row">
        <%= label_tag "users_unit",raw("Unit"), :class=>"text"%>
        <span class="in-box">
          <%= select("users","unit", Unit.active.where("department_id=?", params[:department]).collect {|p| [ p.name, p.id ] },:prompt => "SELECT A UNIT") %>
        </span>
      </div>
      <% else %>
        <div class="form-sec-row">
        <%= label_tag :role_id, raw("Role"), :class=>"text" %>
        <span class="in-box">       
           <%= select("role", "id", Role.where("name != 'Super Admin' && name != 'Department Admin'").collect {|role| [role.name, role.id]},:prompt=>"SELECT A ROLE") %>
        </span>
      </div>
      <div class="form-sec-row">
        <%= label_tag "users_agency", raw("Agency"), :class=>"text" %>
        <span class="in-box">         
          <%agency = Agency.find(current_department.agency_id) %>
          <%= select("users","agency_user",  Agency.find_all_by_id(current_department.agency_id).collect {|agency| [agency.name, agency.id]},:prompt=>"SELECT AN AGENCY") %>
        </span>
      </div>
      <div class="form-sec-row">
        <%= label_tag "users_department", raw("Department"), :class=>"text"%>
        <span class="in-box">
          <%= select("users","department", current_user.departments.collect {|p| [ p.name, p.id ] },:prompt => "SELECT A DEPARTMENT") %>
        </span>
      </div>
      <div class="form-sec-row">
        <%= label_tag "users_unit",raw("Unit"), :class=>"text"%>
        <span class="in-box">
          <%= select("users","unit", Unit.active.where("department_id=?", current_department.id).collect {|p| [ p.name, p.id ] },:prompt => "SELECT A UNIT") %>
        </span>
      </div>
     <% end %>

      <div class="form-sec-row">
        <label class="text">&nbsp;</label>
        <span class="in-box">
          <%= f.submit :class=>"btn2"%>
        </span>
      </div>
      <div class="clear"></div>
      <!--BODY END-->
    <%end%>
  </div>
</div>
<div class="clearfix"></div>
