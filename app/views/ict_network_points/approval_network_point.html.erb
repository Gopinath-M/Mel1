<%= form_for(@ict_network, :url=>update_approval_network_point_ict_network_points_path) do |f| %>
  <%= f. error_messages%>
  <div class="clearfix"></div>
  <div class="CenterNav">
    <div class="form-sec">
      <h2 class="b-head"><%=t('labels.app_for_net_point')%></h2>
      <div class="form-sec">

        <%= hidden_field_tag :updated_by, (current_user.id) %>
        <%= hidden_field_tag :id, (@ict_network.id) %>
        <%= hidden_field_tag :user_id, (@ict_network.user_id) %>
        <font color="#369" size="3"><br/><b><u><%=t('labels.user_details')%></u><br/><br/></b></font>
        <% @dept = IctNetworkPoint.find_by_department_id(@ict_network.department_id) %>
        <% @dept_name = Department.find(@dept.department_id)%>
        <% @agency = Agency.find(@dept_name.agency_id) %>
        <% @user = IctNetworkPoint.find_by_user_id(@ict_network.user_id) %>
        <% @user_name = User.find(@user.user_id) %>

        <div class="form-sec-row">
          <label class="text"><%=t('labels.agency_name')%></label>
          <span class="in-box"><%= @agency.name  %></span>
        </div>
        <div class="form-sec-row">
          <label class="text"><%=t('labels.department_name')%></label>
          <span class="in-box">
            <%= @dept_name.name  %></span>
        </div>
        <div class="form-sec-row">
          <label class="text"><%=t('labels.first_name')%></label>
          <span class="in-box">
            <%= @user_name.first_name %></span>
        </div>
        <div class="form-sec-row">
          <label class="text"><%=t('labels.last_name')%></label>
          <span class="in-box"><%= @user_name.last_name %></span>
        </div>
        <div class="form-sec-row">
          <label class="text"><%=t('labels.contact_number')%></label>
          <span class="in-box"><%= @user_name.contact_mobile  %></span>
        </div>

        <div class="form-sec-row">
          <label class="text"><%=t('labels.ic_no')%></label>
          <span class="in-box">
            <%= @user_name.ic_number %></span>
        </div>

        <div class="form-sec-row">
          <label class="text"><%=t('labels.email')%></label>
          <span class="in-box">
            <%= @user_name.email %></span>
        </div>

        <h2 class="b-head"></h2>
        <font color="#369" size="3"><br/><b><u><%=t('labels.requisition_details')%> :-</u><br/><br/></b></font>
        <div class="form-sec-row">
          <label class="text"><%=t('labels.ticket_no')%></label>
          <span class="in-box"><font color="red"><b>&nbsp;<%= @ict_network.id %>/<%=Time.now.year%></span>
                </div>

                <div class="form-sec-row">
                  <label class="text"><%=t('labels.date_of_app')%></label>
                  <span class="in-box"><%= @ict_network.created_at.strftime("%a %d %b %Y %I:%M %p")%></span>
                </div>

                </div>

                <div class="form-sec-row">
                  <label class="text"><%=t('labels.type_of_facility')%></label>
                  <span class="in-box">
                    <%= @type_name.name %>
                  </span>
                </div>

                <div class="form-sec-row">
                  <% if @ict_network.ict_network_attachment.present? %>
                    <label class="text"><%=t('labels.attachment')%></label>
                    <% image = @ict_network.ict_network_attachment.url(:profile).split(".").last %>
                    <% if image == "gif" || image == "jpg" || image == "jpeg" || image == "png" %>
                      <span class="in-box">
                        <%=image_tag(@ict_network.ict_network_attachment.url(:profile),:title=>@ict_network.ict_network_attachment)%>
                      <%else%>
                        <% file = (@ict_network.ict_network_attachment).url(:profile).split("/").last %>
                        <td>&nbsp;<b><%= link_to file, download_attachments_ict_network_points_path(:id=>@ict_network.id) if @ict_network.ict_network_attachment?  %></b></td>
                      </span>
                    <%end%>
                  <%end%>
                </div>

                <div class="form-sec-row">
                  <label class="text"><%=t('labels.justification')%></label>
                  <span class="in-box">
                    <%= @ict_network.justification %>
                  </span>
                </div>

                <div class="form-sec-row">
                  <label class="text"><%=t('labels.location')%></label>
                  <span class="in-box">
                    <%= @ict_network.location %>
                  </span>
                </div>

                <div class="form-sec-row">
                  <label class="text"><%=t('labels.quantity')%></label>
                  <span class="in-box">
                    <%= @ict_network.quantity %>
                  </span>
                </div>

  <%# if @ict_network.status == "Approved"%>
  <%# username = User.find(@ict_network.updated_by) %>
  <%#*<h2 class="b-head"></h2>%>
  <%#*<div class="form-sec-row">%>
  <%#*<label class="text">Approved by</label>%>
  <%#*<span class="in-box">%>
  <%#= username.username %>
  <%#*</span>%>
  <%#*</div>%>
  <%#*<div class="form-sec-row">%>
  <%#*<label class="text">Approved at</label>%>
  <%#*<span class="in-box">%>
  <%#= @ict_network.updated_at.localtime.strftime("%d-%m-%Y %H:%M %p") %>
  <%#*</span>%>
  <%#*</div>%>
  <%#elsif @ict_network.status == "Processed"%>
  <%# username = User.find(@ict_network.updated_by) %>
  <%#*<h2 class="b-head"></h2>%>
  <%#*<div class="form-sec-row">%>
  <%#*<label class="text">Processed by</label>%>
  <%#*<span class="in-box">%>
  <%#= username.username %>
  <%#*</span>%>
  <%#*</div>%>
  <%#*<div class="form-sec-row">%>
  <%#*<label class="text">Processed at</label>%>
  <%#*<span class="in-box">%>
  <%#= @ict_network.updated_at.localtime.strftime("%d-%m-%Y %H:%M %p") %>
  <%#*</span>%>
  <%#*</div>%>
  <%#end%>

                <% if @ict_network.status == "Approved" || @ict_network.status == "Processed" || @ict_network.status == "Declined"%>
                  <h2 class="b-head"></h2>
                  <font color="#369" size="3"><br/><b><u><%=t('labels.approval_info')%></u><br/><br/></b></font>

                  <% name = User.find_by_id(@ict_network.person_incharge) %>
                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.person_incharge')%></label>
                    <span class="in-box">
                      <%= name.first_name %>
                    </span>
                  </div>

                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.recommendation_type')%></label>
                    <span class="in-box">
                      <%= @ict_network.recommendation_type %>
                    </span>
                  </div>

                  <% hardware = FacilityIctHardware.find_by_id(@ict_network.hardware_id) %>
                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.hardwares')%></label>
                    <span class="in-box">
                      <%= hardware.name %>
                    </span>
                  </div>

                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.hardware_quantity')%></label>
                    <span class="in-box">
                      <%= @ict_network.hardware_quantity %>
                    </span>
                  </div>

                  <% center = FacilityIctAgency.find_by_id(@ict_network.location_center_id) %>
                  <% wiring = FacilityIctWiring.find_by_id(@ict_network.ict_wiring_id) %>
                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.location_center')%></label>
                    <span class="in-box">
                      <%= center.name %>
                    </span>
                  </div>

                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.ict_wiring')%></label>
                    <span class="in-box">
                      <%= wiring.name %>
                    </span>
                  </div>

                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.remarks')%></label>
                    <span class="in-box">
                      <%= @ict_network.remarks %>
                    </span>
                  </div>

                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.notes')%></label>
                    <span class="in-box">
                      <%= @ict_network.notes %>
                    </span>
                  </div>

                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.current_status')%></label>
                    <span class="in-box">
                      <% if @ict_network.status == "New"%><b><font color='#FFA500'><%= "#{@ict_network.status}" %></font></b><% elsif @ict_network.status == "Approved" || @ict_network.status == "Processed"  %>  <b><font color='#329C20'><%= "#{@ict_network.status}" %> </font></b><% elsif @ict_network.status == "Declined" || @ict_network.status == "Returned"  %>  <b><font color='red'><%= "#{@ict_network.status}" %> </font></b><% end %>
                    </span>
                  </div>

                  <% if @ict_network.person_incharge.present? %>
                    <% if @ict_network.status == "Approved"  && @ict_network.person_incharge == current_user.id %>
                      <h2 class="b-head"></h2>
                      <font color="#369" size="3"><br/><b><u>Status :-</u><br/><br/></b></font>
                      <div class="form-sec-row">
                        <label class="text">Status</label>
                        <span class="in-box">
                          <%select_options=["Processed","Declined"]%>
                          <%=f.select(:status, options_for_select(select_options))%>
                        </span>
                      </div>
                    <%end%>
                  <%end%>
                <%end%>

                <h2 class="b-head"></h2>
                <% if @ict_network.status == "New" %>
                  <font color="#369" size="3"><br/><b><u><%=t('labels.approval_action')%> :-</u><br/><br/></b></font>
                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.action')%><span style=color:red>*</span></label>
                    <span class="in-box">
                      <%select_options=["Approved","Declined"]%>
                      <%=f.select(:status, options_for_select(select_options))%>
                    </span>
                  </div>
                  <div class="form-sec-row">
                    <%@dept = Department.find(default_department)%>
                    <%@users = @dept.users.active.where("role_id = 3 or role_id = 2")%>
                    <label class="text"><%=t('labels.person_incharge')%><span style=color:red>*</span></label>
                    <span class="in-box">
                      <%= f.select(:person_incharge, @users.collect {|p| [ p.username, p.id ] },:prompt => "Select User") %>
                    </span>
                  </div>
                  <div class="form-sec-row" style="background:#fff; margin-top: 10px;">
                    <label class="text"><%=t('labels.recommendation_type')%><span style=color:red>*</span></label>
                    <span class="in-box">
                      <%= f.radio_button :recommendation_type, 'installation', :id=>"check_box_network"%> <b><%= f.label :recommendation_type, t('labels.install') %></b>
                      <%= f.radio_button :recommendation_type, 'purchase', :id=>"check_box_purchase"%> <b><%= f.label :recommendation_type, t('labels.purchase') %></b>
                      <%= f.radio_button :recommendation_type, 'no recommendation', :id=>"check_box_no_recd"%> <b><%= f.label :recommendation_type, t('labels.no_recommendation') %></b>
                    </span>
                  </div>
                  <div id="get_hide" style="display:none; margin-bottom: 10px;"><table width="509" border="0" class="app-table" cellspacing="0" cellpadding="0" align="center" color="#329C20">
                      <tr>
                        <th color="#329C20" width="30%"><b><%=t('labels.hardwares')%></b></th>
                        <th width="30%"><b><%=t('labels.type')%></b></th>
                        <th width="20%"><b><%=t('labels.quantity')%></b></th>
                        <th width="20%"><b><%=t('labels.action')%></b></th>
                      </tr>
                      <tr>
                        <td><%= f.select(:hardware_id, FacilityIctHardware.all.collect {|p| [ p.name, p.id ] },:prompt => "Select Hardware") %></td>
                        <td><%= f.select(:type_id, FacilityIctHardware.all.collect {|p| [ p.name, p.id ] },:prompt => "Select Hardware") %></td>
                        <td><b>&nbsp;<%=f.text_field :hardware_quantity, :class=> "size-quan-box-ict-network"%></b></td>
                        <td id="req_type_network"><b style="color:red;"><%=t('labels.install')%></b></td>
                        <td id="req_type_purchase"style="display:none;"><b style="color:red;"><%=t('labels.purchase')%></b></td>
                      </tr>
                    </table>

                  </div>

                  <div class="form-sec-row">
                    <label class="text"> <%= f.label :notes,t('labels.notes'), :class=>"text"%><span style=color:red>*</span></label>
                    <span class="in-box">
                      <%= f.text_area :notes, :cols => "20", :rows => "3"%>
                    </span>
                  </div>

                  <div class="form-sec-row-ict">
                    <label class="text-ict"> <%= f.label :center_id,raw("<b>Location Center</b><span style=color:red>*</span>"), :class=>"text"%></label>
                    <%= f.select(:location_center_id, FacilityIctAgency.all.collect {|p| [p.name.upcase, p.id]} ,:prompt => "Select Center")%> <%= f.select(:ict_wiring_id, FacilityIctWiring.all.collect {|p| [p.name.upcase, p.id]} ,:prompt => "Select ICT Wiring")%>
                  </div>
                  <div class="form-sec-row">
                    <label class="text"><%=t('labels.remarks')%><span style=color:red>*</span></label>
                    <span class="in-box">
                      <%= f.text_area :remarks, :cols => "20", :rows => "3"%>
                    </span>
                  </div>

                <%end%>

                <div class="form-sec-row">
                  <label class="text">&nbsp;</label>
                  <span class="in-box">
                    <%= link_to t('labels.back'), :back, :class=>"btn1 mr2"%>
                    <%= f.submit :value=>t('labels.submit'), :class=>"btn2"%>
                  </span>
                </div>

                </div>
                </div>
              <%end%>




